{"ast":null,"code":"import _regeneratorRuntime from \"/home/sterbon/Desktop/FoodSCM/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\n\nvar _marked =\n/*#__PURE__*/\n_regeneratorRuntime.mark(connectWithScatter),\n    _marked2 =\n/*#__PURE__*/\n_regeneratorRuntime.mark(attemptAutoLoginWithScatter),\n    _marked3 =\n/*#__PURE__*/\n_regeneratorRuntime.mark(loginWithScatter),\n    _marked4 =\n/*#__PURE__*/\n_regeneratorRuntime.mark(fetchUserWallet),\n    _marked5 =\n/*#__PURE__*/\n_regeneratorRuntime.mark(logOutUser),\n    _marked6 =\n/*#__PURE__*/\n_regeneratorRuntime.mark(transferTokens),\n    _marked7 =\n/*#__PURE__*/\n_regeneratorRuntime.mark(missionsSagas);\n\nimport { takeLatest, put, call } from 'redux-saga/effects';\nimport { SCATTER_ACTIONS, connectedScatter, logInSuccess, connectionError, loginError, setWallet, errorGettingWallet, loggedOut, tokenTransferred, fetchWallet } from './scatter_actions';\nimport { connect, login, loginHistoryExists, getWallet, logout, sendTokens } from \"./scatter_helper\";\nimport { notifyError, notifyInfo, notifySuccess } from \"../utils\";\nvar APP_NAME = 'FoodSCM';\n\nfunction connectWithScatter() {\n  return _regeneratorRuntime.wrap(function connectWithScatter$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          _context.prev = 0;\n          _context.next = 3;\n          return call(connect, APP_NAME);\n\n        case 3:\n          _context.next = 5;\n          return put(connectedScatter());\n\n        case 5:\n          _context.next = 11;\n          break;\n\n        case 7:\n          _context.prev = 7;\n          _context.t0 = _context[\"catch\"](0);\n          _context.next = 11;\n          return put(connectionError());\n\n        case 11:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, _marked, null, [[0, 7]]);\n}\n\nfunction attemptAutoLoginWithScatter() {\n  var _ref, name, publicKey, authority;\n\n  return _regeneratorRuntime.wrap(function attemptAutoLoginWithScatter$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.prev = 0;\n\n          if (!loginHistoryExists()) {\n            _context2.next = 22;\n            break;\n          }\n\n          _context2.next = 4;\n          return call(connect, APP_NAME);\n\n        case 4:\n          _context2.next = 6;\n          return put(connectedScatter());\n\n        case 6:\n          _context2.prev = 6;\n          _context2.next = 9;\n          return call(login);\n\n        case 9:\n          _ref = _context2.sent;\n          name = _ref.name;\n          publicKey = _ref.publicKey;\n          authority = _ref.authority;\n          _context2.next = 15;\n          return put(logInSuccess({\n            name: name,\n            publicKey: publicKey,\n            keyType: authority\n          }));\n\n        case 15:\n          notifySuccess(\"Logged in as \".concat(name), 1);\n          _context2.next = 22;\n          break;\n\n        case 18:\n          _context2.prev = 18;\n          _context2.t0 = _context2[\"catch\"](6);\n          console.error(_context2.t0);\n          notifyError('Scatter rejected login request !', 3);\n\n        case 22:\n          _context2.next = 27;\n          break;\n\n        case 24:\n          _context2.prev = 24;\n          _context2.t1 = _context2[\"catch\"](0);\n          notifyInfo('Please unlock Scatter !', 3);\n\n        case 27:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, _marked2, null, [[0, 24], [6, 18]]);\n}\n\nfunction loginWithScatter() {\n  var _ref2, name, publicKey, authority;\n\n  return _regeneratorRuntime.wrap(function loginWithScatter$(_context3) {\n    while (1) {\n      switch (_context3.prev = _context3.next) {\n        case 0:\n          _context3.prev = 0;\n          _context3.next = 3;\n          return call(connect, APP_NAME);\n\n        case 3:\n          _context3.next = 5;\n          return put(connectedScatter());\n\n        case 5:\n          _context3.prev = 5;\n          _context3.next = 8;\n          return call(login);\n\n        case 8:\n          _ref2 = _context3.sent;\n          name = _ref2.name;\n          publicKey = _ref2.publicKey;\n          authority = _ref2.authority;\n          _context3.next = 14;\n          return put(logInSuccess({\n            name: name,\n            publicKey: publicKey,\n            keyType: authority\n          }));\n\n        case 14:\n          notifySuccess(\"Logged in as \".concat(name), 1);\n          _context3.next = 22;\n          break;\n\n        case 17:\n          _context3.prev = 17;\n          _context3.t0 = _context3[\"catch\"](5);\n          _context3.next = 21;\n          return put(loginError());\n\n        case 21:\n          notifyError('Scatter rejected login request !', 3);\n\n        case 22:\n          _context3.next = 29;\n          break;\n\n        case 24:\n          _context3.prev = 24;\n          _context3.t1 = _context3[\"catch\"](0);\n          _context3.next = 28;\n          return put(connectionError());\n\n        case 28:\n          notifyError('Please unlock Scatter !', 3);\n\n        case 29:\n        case \"end\":\n          return _context3.stop();\n      }\n    }\n  }, _marked3, null, [[0, 24], [5, 17]]);\n}\n\nfunction fetchUserWallet() {\n  var wallet;\n  return _regeneratorRuntime.wrap(function fetchUserWallet$(_context4) {\n    while (1) {\n      switch (_context4.prev = _context4.next) {\n        case 0:\n          _context4.prev = 0;\n          _context4.next = 3;\n          return call(getWallet);\n\n        case 3:\n          wallet = _context4.sent;\n          _context4.next = 6;\n          return put(setWallet(wallet));\n\n        case 6:\n          _context4.next = 12;\n          break;\n\n        case 8:\n          _context4.prev = 8;\n          _context4.t0 = _context4[\"catch\"](0);\n          _context4.next = 12;\n          return put(errorGettingWallet({\n            message: _context4.t0.message\n          }));\n\n        case 12:\n        case \"end\":\n          return _context4.stop();\n      }\n    }\n  }, _marked4, null, [[0, 8]]);\n}\n\nfunction logOutUser() {\n  return _regeneratorRuntime.wrap(function logOutUser$(_context5) {\n    while (1) {\n      switch (_context5.prev = _context5.next) {\n        case 0:\n          _context5.next = 2;\n          return call(logout);\n\n        case 2:\n          _context5.next = 4;\n          return put(loggedOut());\n\n        case 4:\n          notifyInfo('Logged out !', 3);\n\n        case 5:\n        case \"end\":\n          return _context5.stop();\n      }\n    }\n  }, _marked5);\n}\n\nfunction transferTokens(action) {\n  return _regeneratorRuntime.wrap(function transferTokens$(_context6) {\n    while (1) {\n      switch (_context6.prev = _context6.next) {\n        case 0:\n          _context6.prev = 0;\n          _context6.next = 3;\n          return call(sendTokens, action.payload);\n\n        case 3:\n          _context6.next = 5;\n          return put(tokenTransferred());\n\n        case 5:\n          notifySuccess('Successfully transferred tokens', 3);\n          _context6.next = 8;\n          return put(fetchWallet());\n\n        case 8:\n          _context6.next = 13;\n          break;\n\n        case 10:\n          _context6.prev = 10;\n          _context6.t0 = _context6[\"catch\"](0);\n          notifyError(_context6.t0.message, 5);\n\n        case 13:\n        case \"end\":\n          return _context6.stop();\n      }\n    }\n  }, _marked6, null, [[0, 10]]);\n}\n\nexport default function missionsSagas() {\n  return _regeneratorRuntime.wrap(function missionsSagas$(_context7) {\n    while (1) {\n      switch (_context7.prev = _context7.next) {\n        case 0:\n          _context7.next = 2;\n          return takeLatest(SCATTER_ACTIONS.CONNECT, connectWithScatter);\n\n        case 2:\n          _context7.next = 4;\n          return takeLatest(SCATTER_ACTIONS.ATTEMPT_AUTO_LOGIN, attemptAutoLoginWithScatter);\n\n        case 4:\n          _context7.next = 6;\n          return takeLatest(SCATTER_ACTIONS.LOGIN, loginWithScatter);\n\n        case 6:\n          _context7.next = 8;\n          return takeLatest(SCATTER_ACTIONS.GET_WALLET, fetchUserWallet);\n\n        case 8:\n          _context7.next = 10;\n          return takeLatest(SCATTER_ACTIONS.LOG_OUT, logOutUser);\n\n        case 10:\n          _context7.next = 12;\n          return takeLatest(SCATTER_ACTIONS.SEND_TOKEN, transferTokens);\n\n        case 12:\n        case \"end\":\n          return _context7.stop();\n      }\n    }\n  }, _marked7);\n}","map":{"version":3,"sources":["/home/sterbon/Desktop/FoodSCM/src/scatter/scatter_saga.js"],"names":["connectWithScatter","attemptAutoLoginWithScatter","loginWithScatter","fetchUserWallet","logOutUser","transferTokens","missionsSagas","takeLatest","put","call","SCATTER_ACTIONS","connectedScatter","logInSuccess","connectionError","loginError","setWallet","errorGettingWallet","loggedOut","tokenTransferred","fetchWallet","connect","login","loginHistoryExists","getWallet","logout","sendTokens","notifyError","notifyInfo","notifySuccess","APP_NAME","name","publicKey","authority","keyType","console","error","wallet","message","action","payload","CONNECT","ATTEMPT_AUTO_LOGIN","LOGIN","GET_WALLET","LOG_OUT","SEND_TOKEN"],"mappings":";;;;yBAgCUA,kB;;;yBASAC,2B;;;yBAmBAC,gB;;;yBAmBAC,e;;;yBAUAC,U;;;yBAMAC,c;;;yBAWgBC,a;;AA1G1B,SAAQC,UAAR,EAAoBC,GAApB,EAAyBC,IAAzB,QAAoC,oBAApC;AAEA,SACIC,eADJ,EAEIC,gBAFJ,EAGIC,YAHJ,EAIIC,eAJJ,EAKIC,UALJ,EAMIC,SANJ,EAOIC,kBAPJ,EAQIC,SARJ,EASIC,gBATJ,EAUIC,WAVJ,QAWO,mBAXP;AAaA,SACIC,OADJ,EAEIC,KAFJ,EAGIC,kBAHJ,EAIIC,SAJJ,EAKIC,MALJ,EAMIC,UANJ,QAOO,kBAPP;AASA,SACIC,WADJ,EAEIC,UAFJ,EAGIC,aAHJ,QAIO,UAJP;AAMA,IAAMC,QAAQ,GAAG,SAAjB;;AAEA,SAAU7B,kBAAV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEQ,iBAAMS,IAAI,CAACW,OAAD,EAASS,QAAT,CAAV;;AAFR;AAAA;AAGQ,iBAAMrB,GAAG,CAACG,gBAAgB,EAAjB,CAAT;;AAHR;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAKQ,iBAAMH,GAAG,CAACK,eAAe,EAAhB,CAAT;;AALR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AASA,SAAUZ,2BAAV;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA,eAEWqB,kBAAkB,EAF7B;AAAA;AAAA;AAAA;;AAAA;AAGY,iBAAMb,IAAI,CAACW,OAAD,EAASS,QAAT,CAAV;;AAHZ;AAAA;AAIY,iBAAMrB,GAAG,CAACG,gBAAgB,EAAjB,CAAT;;AAJZ;AAAA;AAAA;AAMqD,iBAAMF,IAAI,CAACY,KAAD,CAAV;;AANrD;AAAA;AAMuBS,UAAAA,IANvB,QAMuBA,IANvB;AAM6BC,UAAAA,SAN7B,QAM6BA,SAN7B;AAMwCC,UAAAA,SANxC,QAMwCA,SANxC;AAAA;AAOgB,iBAAMxB,GAAG,CAACI,YAAY,CAAC;AAACkB,YAAAA,IAAI,EAAJA,IAAD;AAAOC,YAAAA,SAAS,EAATA,SAAP;AAAkBE,YAAAA,OAAO,EAAED;AAA3B,WAAD,CAAb,CAAT;;AAPhB;AAQgBJ,UAAAA,aAAa,wBAAiBE,IAAjB,GAAyB,CAAzB,CAAb;AARhB;AAAA;;AAAA;AAAA;AAAA;AAUgBI,UAAAA,OAAO,CAACC,KAAR;AACAT,UAAAA,WAAW,CAAC,kCAAD,EAAqC,CAArC,CAAX;;AAXhB;AAAA;AAAA;;AAAA;AAAA;AAAA;AAeQC,UAAAA,UAAU,CAAC,yBAAD,EAA4B,CAA5B,CAAV;;AAfR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAmBA,SAAUzB,gBAAV;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEQ,iBAAMO,IAAI,CAACW,OAAD,EAASS,QAAT,CAAV;;AAFR;AAAA;AAGQ,iBAAMrB,GAAG,CAACG,gBAAgB,EAAjB,CAAT;;AAHR;AAAA;AAAA;AAMiD,iBAAMF,IAAI,CAACY,KAAD,CAAV;;AANjD;AAAA;AAMmBS,UAAAA,IANnB,SAMmBA,IANnB;AAMyBC,UAAAA,SANzB,SAMyBA,SANzB;AAMoCC,UAAAA,SANpC,SAMoCA,SANpC;AAAA;AAOY,iBAAMxB,GAAG,CAACI,YAAY,CAAC;AAACkB,YAAAA,IAAI,EAAJA,IAAD;AAAOC,YAAAA,SAAS,EAATA,SAAP;AAAkBE,YAAAA,OAAO,EAAED;AAA3B,WAAD,CAAb,CAAT;;AAPZ;AAQYJ,UAAAA,aAAa,wBAAiBE,IAAjB,GAAyB,CAAzB,CAAb;AARZ;AAAA;;AAAA;AAAA;AAAA;AAAA;AAUY,iBAAMtB,GAAG,CAACM,UAAU,EAAX,CAAT;;AAVZ;AAWYY,UAAAA,WAAW,CAAC,kCAAD,EAAqC,CAArC,CAAX;;AAXZ;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAcQ,iBAAMlB,GAAG,CAACK,eAAe,EAAhB,CAAT;;AAdR;AAeQa,UAAAA,WAAW,CAAC,yBAAD,EAA4B,CAA5B,CAAX;;AAfR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAmBA,SAAUvB,eAAV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEuB,iBAAMM,IAAI,CAACc,SAAD,CAAV;;AAFvB;AAEca,UAAAA,MAFd;AAAA;AAGQ,iBAAM5B,GAAG,CAACO,SAAS,CAACqB,MAAD,CAAV,CAAT;;AAHR;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAKQ,iBAAM5B,GAAG,CAACQ,kBAAkB,CAAC;AAACqB,YAAAA,OAAO,EAAE,aAAEA;AAAZ,WAAD,CAAnB,CAAT;;AALR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAUA,SAAUjC,UAAV;AAAA;AAAA;AAAA;AAAA;AAAA;AACI,iBAAMK,IAAI,CAACe,MAAD,CAAV;;AADJ;AAAA;AAEI,iBAAMhB,GAAG,CAACS,SAAS,EAAV,CAAT;;AAFJ;AAGIU,UAAAA,UAAU,CAAC,cAAD,EAAiB,CAAjB,CAAV;;AAHJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAMA,SAAUtB,cAAV,CAAyBiC,MAAzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEQ,iBAAM7B,IAAI,CAACgB,UAAD,EAAaa,MAAM,CAACC,OAApB,CAAV;;AAFR;AAAA;AAGQ,iBAAM/B,GAAG,CAACU,gBAAgB,EAAjB,CAAT;;AAHR;AAIQU,UAAAA,aAAa,CAAC,iCAAD,EAAoC,CAApC,CAAb;AAJR;AAKQ,iBAAMpB,GAAG,CAACW,WAAW,EAAZ,CAAT;;AALR;AAAA;AAAA;;AAAA;AAAA;AAAA;AAOQO,UAAAA,WAAW,CAAC,aAAEW,OAAH,EAAY,CAAZ,CAAX;;AAPR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAWA,eAAe,SAAW/B,aAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AACX,iBAAMC,UAAU,CAACG,eAAe,CAAC8B,OAAjB,EAA0BxC,kBAA1B,CAAhB;;AADW;AAAA;AAEX,iBAAMO,UAAU,CAACG,eAAe,CAAC+B,kBAAjB,EAAqCxC,2BAArC,CAAhB;;AAFW;AAAA;AAGX,iBAAMM,UAAU,CAACG,eAAe,CAACgC,KAAjB,EAAwBxC,gBAAxB,CAAhB;;AAHW;AAAA;AAIX,iBAAMK,UAAU,CAACG,eAAe,CAACiC,UAAjB,EAA6BxC,eAA7B,CAAhB;;AAJW;AAAA;AAKX,iBAAMI,UAAU,CAACG,eAAe,CAACkC,OAAjB,EAA0BxC,UAA1B,CAAhB;;AALW;AAAA;AAMX,iBAAMG,UAAU,CAACG,eAAe,CAACmC,UAAjB,EAA6BxC,cAA7B,CAAhB;;AANW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA","sourcesContent":["import {takeLatest, put, call} from 'redux-saga/effects';\n\nimport {\n    SCATTER_ACTIONS,\n    connectedScatter,\n    logInSuccess,\n    connectionError,\n    loginError,\n    setWallet,\n    errorGettingWallet,\n    loggedOut,\n    tokenTransferred,\n    fetchWallet\n} from './scatter_actions';\n\nimport {\n    connect,\n    login,\n    loginHistoryExists,\n    getWallet,\n    logout,\n    sendTokens\n} from \"./scatter_helper\";\n\nimport {\n    notifyError,\n    notifyInfo,\n    notifySuccess\n} from \"../utils\";\n\nconst APP_NAME = 'FoodSCM';\n\nfunction* connectWithScatter(){\n    try{\n        yield call(connect,APP_NAME);\n        yield put(connectedScatter());\n    }catch(e){\n        yield put(connectionError());\n    }\n}\n\nfunction* attemptAutoLoginWithScatter(){\n    try{\n        if(loginHistoryExists()){\n            yield call(connect,APP_NAME);\n            yield put(connectedScatter());\n            try{\n                const {name, publicKey, authority} = yield call(login);\n                yield put(logInSuccess({name, publicKey, keyType: authority}));\n                notifySuccess(`Logged in as ${name}`, 1);\n            }catch (e) {\n                console.error(e)\n                notifyError('Scatter rejected login request !', 3);\n            }\n        }\n    }catch(e){\n        notifyInfo('Please unlock Scatter !', 3);\n    }\n}\n\nfunction* loginWithScatter(){\n    try{\n        yield call(connect,APP_NAME);\n        yield put(connectedScatter());\n\n        try{\n            const {name, publicKey, authority} = yield call(login);\n            yield put(logInSuccess({name, publicKey, keyType: authority}));\n            notifySuccess(`Logged in as ${name}`, 1);\n        }catch(e){\n            yield put(loginError());\n            notifyError('Scatter rejected login request !', 3);\n        }\n    }catch(e){\n        yield put(connectionError());\n        notifyError('Please unlock Scatter !', 3);\n    }\n}\n\nfunction* fetchUserWallet(){\n    try{\n        const wallet = yield call(getWallet);\n        yield put(setWallet(wallet));\n    }catch(e){\n        yield put(errorGettingWallet({message: e.message}));\n        // notifyError('Error fetching wallet !', 3);\n    }\n}\n\nfunction* logOutUser(){\n    yield call(logout);\n    yield put(loggedOut());\n    notifyInfo('Logged out !', 3);\n}\n\nfunction* transferTokens(action){\n    try {\n        yield call(sendTokens, action.payload);\n        yield put(tokenTransferred());\n        notifySuccess('Successfully transferred tokens', 3);\n        yield put(fetchWallet());\n    } catch (e) {\n        notifyError(e.message, 5);\n    }\n}\n\nexport default function*  missionsSagas(){\n    yield takeLatest(SCATTER_ACTIONS.CONNECT, connectWithScatter);\n    yield takeLatest(SCATTER_ACTIONS.ATTEMPT_AUTO_LOGIN, attemptAutoLoginWithScatter);\n    yield takeLatest(SCATTER_ACTIONS.LOGIN, loginWithScatter);\n    yield takeLatest(SCATTER_ACTIONS.GET_WALLET, fetchUserWallet);\n    yield takeLatest(SCATTER_ACTIONS.LOG_OUT, logOutUser);\n    yield takeLatest(SCATTER_ACTIONS.SEND_TOKEN, transferTokens);\n}"]},"metadata":{},"sourceType":"module"}